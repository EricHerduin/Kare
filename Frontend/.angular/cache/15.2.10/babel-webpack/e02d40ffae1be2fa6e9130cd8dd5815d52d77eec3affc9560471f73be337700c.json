{"ast":null,"code":"import { EventEmitter } from \"@angular/core\";\nimport { map } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/services/diet-book.service\";\nimport * as i3 from \"src/app/services/meal.service\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"../mealform/mealform.component\";\nimport * as i7 from \"../../../core/array-dietmeal/array-dietmeal.component\";\nfunction SingleDietComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"div\", 6)(2, \"div\")(3, \"h3\");\n    i0.ɵɵtext(4, \"Livret N\\u00B0\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"button\", 7);\n    i0.ɵɵlistener(\"click\", function SingleDietComponent_div_2_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.onModify());\n    });\n    i0.ɵɵtext(8, \"modifier\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"button\", 7);\n    i0.ɵɵlistener(\"click\", function SingleDietComponent_div_2_Template_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.onAddMeal());\n    });\n    i0.ɵɵtext(10, \"Ajouter un Repas\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"div\", 8)(12, \"div\", 9)(13, \"p\", 10);\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"p\", 11);\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(17, \"div\", 12)(18, \"div\", 13)(19, \"div\", 12)(20, \"h4\");\n    i0.ɵɵtext(21, \"Pathologie\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"p\");\n    i0.ɵɵtext(23);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(24, \"div\", 12)(25, \"h4\");\n    i0.ɵɵtext(26, \"Sexe\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"p\");\n    i0.ɵɵtext(28);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(29, \"div\", 13)(30, \"div\", 14)(31, \"h4\");\n    i0.ɵɵtext(32, \"Nbre d'\\u00E9tape\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"p\");\n    i0.ɵɵtext(34);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(35, \"div\", 14)(36, \"h4\");\n    i0.ɵɵtext(37, \"Nbre de semaines/\\u00E9tape\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(38, \"p\");\n    i0.ɵɵtext(39);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(40, \"div\", 15)(41, \"h4\");\n    i0.ɵɵtext(42, \"description du livret\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(43, \"p\");\n    i0.ɵɵtext(44);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(45, \"app-array-dietmeal\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const dietBook_r2 = ctx.ngIf;\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(dietBook_r2.id);\n    i0.ɵɵadvance(8);\n    i0.ɵɵtextInterpolate(dietBook_r2.title);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", dietBook_r2.online === 1 ? \"En Ligne\" : \"\", \" \");\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate(dietBook_r2.pathology);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(dietBook_r2.sexe);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(dietBook_r2.nbStage);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(dietBook_r2.nbWeekPerStage);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(dietBook_r2.description);\n  }\n}\nfunction SingleDietComponent_app_mealform_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-mealform\", 16);\n    i0.ɵɵlistener(\"closeMealForm\", function SingleDietComponent_app_mealform_5_Template_app_mealform_closeMealForm_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.onCloseMealFormClicked());\n    });\n    i0.ɵɵelementEnd();\n  }\n}\nexport class SingleDietComponent {\n  constructor(route, router, dietBookService, mealService, formBuilder) {\n    this.route = route;\n    this.router = router;\n    this.dietBookService = dietBookService;\n    this.mealService = mealService;\n    this.formBuilder = formBuilder;\n    this.mealOrder = [\"Petit-déjeuner\", \"Collation-am\", \"Déjeuner\", \"Collation-pm1\", \"Collation-pm2\", \"Diner\"];\n    this.closeMealForm = new EventEmitter();\n  }\n  ngOnInit() {\n    this.route.queryParams.subscribe(params => {\n      this.dietId = params[\"dietId\"];\n      this.mealId = params[\"mealId\"];\n      this.dietbook$ = this.dietBookService.getDietBookById(this.dietId);\n      // this.dietBookService.getDietBookById(this.dietId).subscribe((book) => {\n      //   this.dietBook = book;\n      // });\n      if (this.mealId === undefined) {\n        this.route.queryParams.subscribe(params => {\n          this.dietId = params[\"dietId\"];\n          this.dietBookService.getDietBookById(this.dietId).subscribe(dietbook => {\n            if (dietbook.meal) {\n              this.mealIds = dietbook.meal.map(m => m);\n              this.loadMeals();\n            }\n          });\n        });\n      } else if (this.mealId !== \"addMeal\" || undefined) {\n        this.mealService.getAllMeat().pipe(map(meals => meals.filter(meal => this.mealIds.includes(meal.id)))).subscribe(filteredMeals => {\n          this.meals = filteredMeals;\n        });\n        if (this.activeButton > 0) {\n          this.onClickButton(this.activeButton);\n        }\n      }\n    });\n  }\n  onCloseMealFormClicked() {\n    this.closeMealForm.emit();\n  }\n  //charge les meals selon le livret dans array\n  loadMeals() {\n    this.dietBookService.getDietBookById(this.dietId).subscribe(book => {\n      this.dietBook = book;\n      if (book.meal) {\n        this.mealIds = book.meal.map(m => m);\n        // Charger les repas correspondants\n        this.mealService.getAllMeat().subscribe(allMeals => {\n          this.meals = allMeals.filter(meal => this.mealIds.includes(meal.id));\n          // Mettre à jour l'affichage des repas en fonction du bouton actif\n          if (this.activeButton) {\n            this.onClickButton(this.activeButton);\n          }\n        });\n      }\n    });\n  }\n  //défini le nombre d'étape pour afficher les boutons de sélection des Meals par semaine\n  getRange(stage) {\n    return Array(stage).fill(0).map((_, index) => index + 1);\n  }\n  //renomme les collations am-pm1-pm2\n  getMealSortName(meal) {\n    let name = meal.typeMeal;\n    let collation = meal.collation;\n    if (meal.typeMeal === \"Collation\") {\n      name += \"-\" + collation;\n    }\n    return name;\n  }\n  // filtre les meals à afficher pour la semaine délectionnée\n  onClickButton(buttonNum) {\n    this.activeButton = buttonNum;\n    this.MealsToDisplay = this.meals.filter(filterStage => {\n      return filterStage.stage.includes(buttonNum);\n    });\n    this.MealsToDisplay.sort((a, b) => {\n      let nameA = this.getMealSortName(a);\n      let nameB = this.getMealSortName(b);\n      return this.mealOrder.indexOf(nameA) - this.mealOrder.indexOf(nameB);\n    });\n  }\n  //accède au livret pour modification des données\n  onModify() {\n    this.router.navigateByUrl(`/modify-diet_book?dietId=${this.dietId}`);\n  }\n  // ajoute un nouveau meal au livret\n  onAddMeal() {\n    this.router.navigateByUrl(`dietbook?dietId=${this.dietId}&mealId=addMeal`);\n  }\n  //remet la variable activeButtonMeal à 0 pour désactiver le meal sélectionné. ne fonctionne pas\n  onMealFormCancel() {\n    console.log(\"annulation reçue dans singleDiet\");\n    this.activeButtonMeal = \"0\";\n  }\n  //accède au meal sélectionné par son id\n  onViewMealForm(id) {\n    this.activeButtonMeal = id;\n    this.router.navigateByUrl(`dietbook?dietId=${this.dietId}&mealId=${id}`);\n  }\n  static #_ = this.ɵfac = function SingleDietComponent_Factory(t) {\n    return new (t || SingleDietComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.DietBooksService), i0.ɵɵdirectiveInject(i3.mealService), i0.ɵɵdirectiveInject(i4.FormBuilder));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: SingleDietComponent,\n    selectors: [[\"app-single-diet\"]],\n    outputs: {\n      closeMealForm: \"closeMealForm\"\n    },\n    decls: 6,\n    vars: 4,\n    consts: [[1, \"container\"], [1, \"container-form\"], [\"class\", \"card\", 4, \"ngIf\"], [1, \"container-meal\"], [3, \"closeMealForm\", 4, \"ngIf\"], [1, \"card\"], [1, \"form-card-item\"], [3, \"click\"], [1, \"form-card\"], [1, \"form-card-group_title\"], [1, \"form-card-title\"], [1, \"online_status\"], [1, \"form-card-group_item\"], [1, \"form-card-group\"], [1, \"form-card-group_item\", \"number\"], [1, \"form-card-group_item\", \"description\"], [3, \"closeMealForm\"]],\n    template: function SingleDietComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1);\n        i0.ɵɵtemplate(2, SingleDietComponent_div_2_Template, 46, 8, \"div\", 2);\n        i0.ɵɵpipe(3, \"async\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"div\", 3);\n        i0.ɵɵtemplate(5, SingleDietComponent_app_mealform_5_Template, 1, 0, \"app-mealform\", 4);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(3, 2, ctx.dietbook$));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.mealId !== undefined);\n      }\n    },\n    dependencies: [i5.NgIf, i6.MealformComponent, i7.ArrayDietmealComponent, i5.AsyncPipe],\n    styles: [\"var[_ngcontent-%COMP%]   resource[_ngcontent-%COMP%];\\n (()[_ngcontent-%COMP%]   =[_ngcontent-%COMP%] >  { // webpackBootstrap\\n \\tvar __webpack_modules__ = ({\\n\\n 398:\\n\\n (() => {\\n\\nthrow new Error(\\\"Module build failed (from ./node_modules/sass-loader/dist/cjs.js):\\\\nSassError: expected \\\\\\\";\\\\\\\".\\\\n   \\u2577\\\\n87 \\u2502         font-size: 10px;\\\\n   \\u2502                  ^\\\\n   \\u2575\\\\n  src/app/livrets/diet/single-diet/single-diet.component.scss 87:18  root stylesheet\\\");\\n\\n })\\n\\n \\t});\\n\\n \\t\\n \\t// startup\\n \\t// Load entry module and return exports\\n \\t// This entry module doesn't tell about it's top-level declarations so it can't be inlined\\n \\tvar __webpack_exports__ = {};\\n \\t__webpack_modules__[398]();\\n \\tresource = __webpack_exports__;\\n \\t\\n })()\\n;\"]\n  });\n}","map":{"version":3,"mappings":"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","names":["EventEmitter","map","i0","SingleDietComponent","constructor","route","router","dietBookService","mealService","formBuilder","ngOnInit","queryParams","subscribe","params","dietId","mealId","dietbook$","getDietBookById","undefined","dietbook","meal","mealIds","m","loadMeals","getAllMeat","pipe","meals","filter","includes","id","filteredMeals","activeButton","onClickButton","onCloseMealFormClicked","closeMealForm","emit","book","dietBook","allMeals","getRange","stage","Array","fill","_","index","getMealSortName","name","typeMeal","collation","buttonNum","MealsToDisplay","filterStage","sort","a","b","nameA","nameB","mealOrder","indexOf","onModify","navigateByUrl","onAddMeal","onMealFormCancel","console","log","activeButtonMeal","onViewMealForm","selectors","outputs","decls","vars","consts","template"],"sourceRoot":"","sources":["/Users/ericherduin/Htag/Site Web/BD2 Konect/Frontend/src/app/livrets/diet/single-diet/single-diet.component.ts","/Users/ericherduin/Htag/Site Web/BD2 Konect/Frontend/src/app/livrets/diet/single-diet/single-diet.component.html"],"sourcesContent":["import { Component, OnInit, Output, EventEmitter } from \"@angular/core\";\nimport { Observable, take, tap, map } from \"rxjs\";\nimport { DietBook } from \"src/app/models/diet.model\";\nimport { ActivatedRoute, Router } from \"@angular/router\";\nimport { DietBooksService } from \"src/app/services/diet-book.service\";\nimport { FormBuilder, FormGroup } from \"@angular/forms\";\n\nimport { mealService } from \"src/app/services/meal.service\";\nimport { Meal } from \"src/app/models/meal.model\";\n\n@Component({\n  selector: \"app-single-diet\",\n  templateUrl: \"./single-diet.component.html\",\n  styleUrls: [\"./single-diet.component.scss\"],\n})\nexport class SingleDietComponent implements OnInit {\n  dietbook$!: Observable<DietBook>;\n  dietBook!: DietBook;\n  meals!: Meal[];\n  MealsToDisplay!: Meal[];\n  mealIds!: string[];\n  dietBookFormRead!: FormGroup;\n  activeButton!: number;\n  activeButtonMeal!: string;\n  selectedStage!: string;\n  save!: string;\n  mealOrder: string[] = [\n    \"Petit-déjeuner\",\n    \"Collation-am\",\n    \"Déjeuner\",\n    \"Collation-pm1\",\n    \"Collation-pm2\",\n    \"Diner\",\n  ];\n  public dietId!: string;\n  public mealId!: any;\n\n  constructor(\n    private route: ActivatedRoute,\n    private router: Router,\n    private dietBookService: DietBooksService,\n    private mealService: mealService,\n    private formBuilder: FormBuilder\n  ) {}\n\n  @Output() closeMealForm: EventEmitter<void> = new EventEmitter<void>();\n\n  ngOnInit(): void {\n    this.route.queryParams.subscribe((params) => {\n      this.dietId = params[\"dietId\"];\n      this.mealId = params[\"mealId\"];\n\n      this.dietbook$ = this.dietBookService.getDietBookById(this.dietId);\n      // this.dietBookService.getDietBookById(this.dietId).subscribe((book) => {\n      //   this.dietBook = book;\n      // });\n      if (this.mealId === undefined) {\n        this.route.queryParams.subscribe((params) => {\n          this.dietId = params[\"dietId\"];\n          this.dietBookService\n            .getDietBookById(this.dietId)\n            .subscribe((dietbook) => {\n              if (dietbook.meal) {\n                this.mealIds = dietbook.meal.map((m) => m);\n\n                this.loadMeals();\n              }\n            });\n        });\n      } else if (this.mealId !== \"addMeal\" || undefined) {\n        this.mealService\n          .getAllMeat()\n          .pipe(\n            map((meals) =>\n              meals.filter((meal) => this.mealIds.includes(meal.id))\n            )\n          )\n          .subscribe((filteredMeals) => {\n            this.meals = filteredMeals;\n          });\n\n        if (this.activeButton > 0) {\n          this.onClickButton(this.activeButton);\n        }\n      }\n    });\n  }\n  onCloseMealFormClicked() {\n    this.closeMealForm.emit();\n  }\n\n  //charge les meals selon le livret dans array\n  loadMeals(): void {\n    this.dietBookService.getDietBookById(this.dietId).subscribe((book) => {\n      this.dietBook = book;\n      if (book.meal) {\n        this.mealIds = book.meal.map((m) => m);\n\n        // Charger les repas correspondants\n        this.mealService.getAllMeat().subscribe((allMeals) => {\n          this.meals = allMeals.filter((meal) =>\n            this.mealIds.includes(meal.id)\n          );\n\n          // Mettre à jour l'affichage des repas en fonction du bouton actif\n          if (this.activeButton) {\n            this.onClickButton(this.activeButton);\n          }\n        });\n      }\n    });\n  }\n\n  //défini le nombre d'étape pour afficher les boutons de sélection des Meals par semaine\n  getRange(stage: number): number[] {\n    return Array(stage)\n      .fill(0)\n      .map((_, index) => index + 1);\n  }\n\n  //renomme les collations am-pm1-pm2\n  getMealSortName(meal: Meal) {\n    let name = meal.typeMeal;\n    let collation = meal.collation;\n\n    if (meal.typeMeal === \"Collation\") {\n      name += \"-\" + collation;\n    }\n\n    return name;\n  }\n\n  // filtre les meals à afficher pour la semaine délectionnée\n  onClickButton(buttonNum: number) {\n    this.activeButton = buttonNum;\n\n    this.MealsToDisplay = this.meals.filter((filterStage) => {\n      return filterStage.stage.includes(buttonNum);\n    });\n    this.MealsToDisplay.sort((a, b) => {\n      let nameA = this.getMealSortName(a);\n      let nameB = this.getMealSortName(b);\n\n      return this.mealOrder.indexOf(nameA) - this.mealOrder.indexOf(nameB);\n    });\n  }\n\n  //accède au livret pour modification des données\n  onModify() {\n    this.router.navigateByUrl(`/modify-diet_book?dietId=${this.dietId}`);\n  }\n\n  // ajoute un nouveau meal au livret\n  onAddMeal() {\n    this.router.navigateByUrl(`dietbook?dietId=${this.dietId}&mealId=addMeal`);\n  }\n  //remet la variable activeButtonMeal à 0 pour désactiver le meal sélectionné. ne fonctionne pas\n  onMealFormCancel() {\n    console.log(\"annulation reçue dans singleDiet\");\n    this.activeButtonMeal = \"0\";\n  }\n\n  //accède au meal sélectionné par son id\n  onViewMealForm(id: string) {\n    this.activeButtonMeal = id;\n    this.router.navigateByUrl(`dietbook?dietId=${this.dietId}&mealId=${id}`);\n  }\n}\n","<div class=\"container\">\n  <div class=\"container-form\">\n    <div class=\"card\" *ngIf=\"dietbook$ | async as dietBook\">\n      <div class=\"form-card-item\">\n        <div>\n          <h3>Livret N°</h3>\n          <p>{{ dietBook.id }}</p>\n        </div>\n        <button (click)=\"onModify()\">modifier</button>\n        <button (click)=\"onAddMeal()\">Ajouter un Repas</button>\n      </div>\n      <div class=\"form-card\">\n        <div class=\"form-card-group_title\">\n          <p class=\"form-card-title\">{{ dietBook.title }}</p>\n          <p class=\"online_status\">\n            {{ dietBook.online === 1 ? \"En Ligne\" : \"\" }}\n          </p>\n        </div>\n        <div class=\"form-card-group_item\">\n          <div class=\"form-card-group\">\n            <div class=\"form-card-group_item\">\n              <h4>Pathologie</h4>\n              <p>{{ dietBook.pathology }}</p>\n            </div>\n            <div class=\"form-card-group_item\">\n              <h4>Sexe</h4>\n              <p>{{ dietBook.sexe }}</p>\n            </div>\n          </div>\n          <div class=\"form-card-group\">\n            <div class=\"form-card-group_item number\">\n              <h4>Nbre d'étape</h4>\n              <p>{{ dietBook.nbStage }}</p>\n            </div>\n            <div class=\"form-card-group_item number\">\n              <h4>Nbre de semaines/étape</h4>\n              <p>{{ dietBook.nbWeekPerStage }}</p>\n            </div>\n          </div>\n        </div>\n        <div class=\"form-card-group_item description\">\n          <h4>description du livret</h4>\n          <p>{{ dietBook.description }}</p>\n        </div>\n\n        <app-array-dietmeal></app-array-dietmeal>\n      </div>\n    </div>\n  </div>\n  <div class=\"container-meal\">\n    <app-mealform\n      *ngIf=\"mealId !== undefined\"\n      (closeMealForm)=\"onCloseMealFormClicked()\"\n    ></app-mealform>\n    <!--problème à régler : ne pas charger si mealId est undefined-->\n  </div>\n</div>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}